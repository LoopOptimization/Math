import Testing;
import Arena;
import Array;
import ArrayConcepts;
import ArrayParse;
import ArrayPrint;
import Comparisons;
import CorePrint;
import ManagedArray;
import MatDim;
import Rational;
import Simplex;
import std;

using namespace ::math;
using utils::operator""_mat;
using namespace testing;

namespace {
auto simplexFromTableau(alloc::Arena<> *alloc, PtrMatrix<std::int64_t> tableau)
  -> Simplex & {
  std::ptrdiff_t numCon = std::ptrdiff_t(tableau.numRow()) - 1;
  std::ptrdiff_t numVar = std::ptrdiff_t(tableau.numCol()) - 1;
  Simplex &simp{Simplex::create(alloc, row(numCon), col(numVar))};
  static constexpr auto check_invalid = [](auto x) {
    return x == std::numeric_limits<std::int64_t>::min();
  };
  invariant(find_first(tableau, check_invalid) < 0);
  simp.getTableau() << tableau;
  PtrMatrix<Simplex::value_type> C{simp.getConstraints()};
  invariant(find_first(C, check_invalid) < 0);
  return simp;
}
} // namespace

auto main(int argc, char *argv[]) -> int {
  cfg<override> = {.filter = argc > 1 ? argv[1] : ""};
  alloc::OwningArena<> managed_alloc;
  "SimplexTest"_test = [&managed_alloc] -> void {
    // 10 >= 3x + 2y + z
    // 15 >= 2x + 5y + 3z
    alloc::Arena<> alloc = managed_alloc;
    IntMatrix<> A{"[10 3 2 1; 15 2 5 3]"_mat};
    IntMatrix<> B{DenseDims<>{row(0), col(4)}};
    IntMatrix<> D{"[0 0 0 -2 -3 -4; 10 1 0  3  2  1; 15 0 1  2  5  3 ]"_mat};
    Optional<Simplex &> optS0{Simplex::positiveVariables(&alloc, A)};
    expect(fatal(optS0.hasValue()));
    Optional<Simplex &> optS1{Simplex::positiveVariables(&alloc, A, B)};
    expect(fatal(optS1.hasValue()));
    for (std::ptrdiff_t i = 0; i < 2; ++i) {
      Simplex &S{i ? *optS1 : *optS0};
      MutPtrVector<Simplex::value_type> C{S.getCost()};
      // minimize -2x - 3y - 4z
      C[0] = 0;
      C[1] = 0;
      C[2] = 0;
      C[3] = -2;
      C[4] = -3;
      C[5] = -4;
      // utils::print("S.tableau =");
      // S->getTableau().print();
      // utils::print('\n');
      expect(S.getTableau() == D);
      expect(S.run() == 20);
      auto s{S.getSolution()};
      expect(s[0] == 5);
      expect(allZero(s[_(1, last)]));
      expect(s[last] == 5);
    }
  };

  "LexMinSmallTest"_test = [&managed_alloc] -> void {
    alloc::Arena<> alloc = managed_alloc;
    // -10 == -3x - 2y - z  + s0
    // -15 == -2x - 5y - 3z + s1
    IntMatrix<> tableau{"[-10 0 1 -1 -2 -3; -15 1 0 -3 -5 -2]"_mat};
    // IntMatrix A{"[-10 -3 -2 -1; -15 -2 -5 -3]"_mat};
    Simplex &simp{Simplex::create(&alloc, row(2), col(5))};
    simp.getConstraints() << tableau;
    Vector<Rational> sol(length(5));
    expect(!(simp.initiateFeasible()));
    // utils::print("S.tableau =");
    // simp->getTableau().print();
    // utils::print('\n');
    //       x  y  z s0  s1 a0 a1
    // [  0  0  0  0  0  0  1  1
    //   10  3  2  1 -1  0  1  0
    //   15  2  5  3  0 -1  0  1 ]
    //       x  y  z s0  s1 a0 a1
    // [  0 -5 -7 -4  1  1  0  0
    //   10  3  2  1 -1  0  1  0
    //   15  2  5  3  0 -1  0  1 ]
    // first entering variable: x
    // first leaving variable: a0
    //       x    y   z s0   s1  a0  a1
    // [-25   0 -11  -7  -2   3   5   0    f: 3
    //   10   3   2   1  -1   0   1   0
    //   25   0  11   7   2  -3  -2   3 ]
    // second entering variable: y
    // second leaving variable: a1
    //       x    y   z  s0  s1  a0  a1
    // [  0   0   0   0   0   0   3   3    f: 3
    //   60  33   0  -3 -15   6  15  -6
    //   25   0  11   7   2  -3  -2   3 ]
    // drop augment vars, divide rows by gcd
    //       x    y   z  s0  s1
    // [  0   0   0   0   0   0    f: 3
    //   20  11   0  -1  -5   2
    //   25   0  11   7   2  -3 ]
    //
    //
    //        x  y  z  s0 s1
    // [ 20  11  0 -1 -5 -30
    //   25  0  11  7  2  1 ]
    // x = 20 // 11
    // y = 25 // 11
    // -3*20/11 - 2*25/11 = (-60 - 50)/11 = -110/11 = -10
    // -2*20/11 - 5*25/11 = (-40 - 125)/11 = -165/11 = -15
    // our initial tableau is feasible
    //
    // [  0  11  0  0  0   0
    //   20  11  0 -1 -5 -30
    //   25  0  11  7  2  1 ]
    //
    // [-20   0  0  1  5  30
    //   20  11  0 -1 -5 -30
    //   25  0  11  7  2  1 ]

    simp.rLexMin(sol);
    // utils::print("S.tableau =");
    // simp->getTableau().print();
    // utils::print('\n');
    //  0  1  2  3  4
    //  0  0 10  0 15
    // 70  0  0  0 25
    //
    // What should happen
    //
    // -10 == -3x - 2y - z  + s0
    // -15 == -2x - 5y - 3z + s1
    // utils::print("sol = ");
    // sol.print();
    // utils::print('\n');
    expect(sol[last - 0] == 0);
    expect(sol[last - 1] == 0);
    expect(sol[last - 2] == 10);
    expect(sol[last - 3] == 0);
    expect(sol[last - 4] == 15);
  };

  "Infeasible"_test = [&managed_alloc] -> void {
    IntMatrix<> C{DenseDims<>{row(220), col(383)}, 0};
    static constexpr auto nzrows = std::array{
      0,   0,   0,   0,   0,   0,   1,   2,   3,   3,   3,   4,   4,   4,
      5,   5,   5,   5,   5,   6,   6,   6,   6,   6,   7,   7,   7,   7,
      7,   7,   8,   8,   9,   9,   10,  10,  10,  11,  11,  11,  12,  12,
      12,  12,  12,  13,  13,  13,  13,  13,  14,  14,  14,  14,  14,  14,
      15,  16,  17,  17,  17,  18,  18,  18,  19,  19,  19,  19,  19,  20,
      20,  20,  20,  20,  21,  21,  21,  21,  21,  21,  22,  22,  23,  23,
      24,  24,  24,  25,  25,  25,  26,  26,  26,  26,  26,  27,  27,  27,
      27,  27,  28,  28,  28,  28,  28,  28,  29,  30,  31,  31,  32,  32,
      32,  33,  33,  33,  33,  33,  34,  34,  34,  34,  34,  35,  35,  35,
      35,  35,  35,  36,  36,  37,  37,  38,  38,  39,  39,  39,  40,  40,
      40,  40,  40,  41,  41,  41,  41,  41,  42,  42,  42,  42,  43,  44,
      45,  45,  45,  46,  46,  46,  47,  47,  47,  47,  47,  48,  48,  48,
      48,  48,  49,  49,  49,  49,  50,  50,  51,  51,  52,  52,  52,  53,
      53,  53,  54,  54,  54,  54,  54,  55,  55,  55,  55,  55,  56,  56,
      56,  56,  56,  56,  57,  58,  59,  59,  60,  60,  60,  61,  61,  61,
      61,  61,  62,  62,  62,  62,  62,  63,  63,  63,  63,  63,  63,  64,
      64,  65,  65,  66,  66,  67,  67,  67,  68,  68,  68,  68,  68,  69,
      69,  69,  69,  69,  70,  70,  70,  70,  70,  70,  70,  70,  70,  71,
      72,  73,  73,  74,  74,  74,  75,  75,  75,  75,  75,  76,  76,  76,
      76,  76,  77,  77,  77,  77,  77,  78,  78,  78,  78,  78,  78,  78,
      78,  78,  79,  79,  80,  80,  81,  81,  82,  82,  82,  83,  83,  83,
      83,  83,  84,  84,  84,  84,  84,  85,  85,  85,  85,  85,  86,  86,
      86,  86,  86,  86,  86,  86,  86,  87,  88,  89,  89,  90,  90,  90,
      91,  91,  91,  91,  91,  92,  92,  92,  92,  92,  93,  93,  93,  93,
      93,  94,  94,  94,  94,  94,  94,  94,  94,  94,  95,  95,  96,  96,
      97,  97,  98,  98,  98,  99,  99,  99,  99,  99,  100, 100, 100, 100,
      100, 101, 101, 101, 101, 101, 102, 102, 102, 102, 102, 102, 102, 103,
      104, 105, 105, 106, 106, 106, 107, 107, 107, 107, 107, 108, 108, 108,
      108, 109, 109, 109, 109, 109, 110, 110, 110, 110, 110, 110, 110, 111,
      111, 112, 112, 113, 113, 114, 114, 114, 115, 115, 115, 115, 115, 116,
      116, 116, 116, 117, 117, 117, 117, 117, 118, 118, 118, 118, 118, 118,
      118, 118, 118, 119, 120, 121, 121, 122, 122, 122, 123, 123, 123, 123,
      123, 124, 124, 124, 124, 124, 125, 125, 125, 125, 125, 126, 126, 126,
      126, 126, 126, 126, 126, 126, 127, 127, 128, 128, 129, 129, 130, 130,
      130, 131, 131, 131, 131, 131, 132, 132, 132, 132, 132, 133, 133, 133,
      133, 133, 134, 134, 134, 134, 134, 134, 134, 134, 134, 135, 136, 137,
      137, 138, 138, 138, 139, 139, 139, 139, 139, 140, 140, 140, 140, 140,
      141, 141, 141, 141, 141, 142, 142, 142, 142, 142, 142, 142, 142, 142,
      143, 143, 144, 144, 145, 145, 146, 146, 146, 147, 147, 147, 147, 147,
      148, 148, 148, 148, 148, 149, 149, 149, 149, 149, 150, 150, 150, 150,
      150, 150, 150, 150, 150, 151, 152, 153, 153, 154, 154, 154, 155, 155,
      155, 155, 155, 156, 156, 156, 156, 156, 157, 157, 157, 157, 157, 158,
      158, 158, 158, 158, 158, 158, 158, 158, 159, 159, 160, 160, 161, 161,
      162, 162, 162, 163, 163, 163, 163, 163, 164, 164, 164, 164, 164, 165,
      165, 165, 165, 165, 166, 166, 166, 166, 166, 166, 166, 167, 168, 169,
      169, 170, 170, 170, 171, 171, 171, 171, 171, 172, 172, 172, 172, 173,
      173, 173, 173, 173, 174, 174, 174, 174, 174, 174, 174, 175, 175, 176,
      176, 177, 177, 178, 178, 178, 179, 179, 179, 179, 179, 180, 180, 180,
      180, 181, 181, 181, 181, 181, 182, 182, 182, 182, 183, 184, 185, 185,
      186, 186, 186, 187, 187, 187, 187, 187, 187, 187, 188, 188, 188, 188,
      189, 189, 189, 189, 189, 189, 190, 190, 190, 190, 190, 190, 190, 190,
      191, 191, 191, 191, 192, 192, 193, 193, 194, 194, 195, 195, 195, 196,
      196, 196, 196, 196, 196, 196, 197, 197, 197, 197, 198, 198, 198, 198,
      198, 198, 199, 199, 199, 199, 199, 199, 199, 199, 200, 200, 200, 200,
      200, 200, 200, 201, 202, 203, 203, 204, 204, 204, 205, 205, 205, 205,
      205, 205, 205, 206, 206, 206, 206, 207, 207, 207, 207, 207, 207, 208,
      208, 208, 208, 208, 208, 208, 208, 209, 209, 209, 209, 209, 209, 209,
      210, 210, 211, 211, 212, 212, 213, 213, 213, 214, 214, 214, 214, 214,
      214, 214, 215, 215, 215, 215, 216, 216, 216, 216, 216, 216, 217, 217,
      217, 217, 217, 217, 217, 217, 218, 218, 218, 218, 219, 219, 219, 219};
    static constexpr auto nzcols = std::array{
      0,   1,   2,   3,   289, 290, 3,   2,   6,   8,   294, 7,   9,   295,
      2,   4,   6,   8,   292, 3,   5,   7,   9,   293, 10,  11,  12,  289,
      290, 296, 12,  310, 11,  311, 15,  17,  294, 16,  18,  295, 11,  13,
      15,  17,  292, 12,  14,  16,  18,  293, 0,   19,  20,  21,  289, 290,
      21,  20,  24,  26,  294, 25,  27,  295, 20,  22,  24,  26,  292, 21,
      23,  25,  27,  293, 28,  29,  30,  289, 290, 297, 30,  312, 29,  313,
      33,  35,  294, 34,  36,  295, 29,  31,  33,  35,  292, 30,  32,  34,
      36,  293, 0,   37,  38,  39,  289, 291, 39,  38,  42,  44,  0,   43,
      45,  38,  40,  42,  44,  292, 39,  41,  43,  45,  293, 46,  47,  48,
      289, 291, 298, 48,  314, 47,  315, 51,  53,  0,   52,  54,  47,  49,
      51,  53,  292, 48,  50,  52,  54,  293, 0,   55,  56,  57,  57,  56,
      60,  62,  294, 61,  63,  295, 56,  58,  60,  62,  294, 57,  59,  61,
      63,  295, 64,  65,  66,  299, 66,  316, 65,  317, 69,  71,  294, 70,
      72,  295, 65,  67,  69,  71,  294, 66,  68,  70,  72,  295, 0,   73,
      74,  75,  290, 291, 75,  74,  78,  80,  0,   79,  81,  74,  76,  78,
      80,  294, 75,  77,  79,  81,  295, 82,  83,  84,  290, 291, 300, 84,
      318, 83,  319, 87,  89,  0,   88,  90,  83,  85,  87,  89,  294, 84,
      86,  88,  90,  295, 0,   91,  92,  93,  95,  98,  100, 289, 291, 92,
      93,  97,  99,  0,   98,  100, 0,   94,  95,  98,  100, 93,  96,  97,
      99,  292, 92,  95,  98,  100, 293, 101, 102, 103, 105, 108, 110, 289,
      291, 301, 102, 320, 103, 321, 107, 109, 0,   108, 110, 0,   104, 105,
      108, 110, 103, 106, 107, 109, 292, 102, 105, 108, 110, 293, 0,   111,
      112, 113, 115, 118, 120, 290, 291, 112, 113, 117, 119, 0,   118, 120,
      0,   114, 115, 118, 120, 113, 116, 117, 119, 294, 112, 115, 118, 120,
      295, 121, 122, 123, 125, 128, 130, 290, 291, 302, 122, 322, 123, 323,
      127, 129, 0,   128, 130, 0,   124, 125, 128, 130, 123, 126, 127, 129,
      294, 122, 125, 128, 130, 295, 0,   131, 132, 133, 135, 138, 140, 132,
      133, 137, 139, 0,   138, 140, 0,   134, 135, 138, 140, 133, 136, 137,
      139, 0,   132, 135, 138, 140, 141, 142, 143, 145, 148, 150, 303, 142,
      324, 143, 325, 147, 149, 0,   148, 150, 0,   144, 145, 148, 150, 143,
      146, 147, 149, 0,   142, 145, 148, 150, 0,   151, 152, 153, 155, 158,
      160, 289, 291, 152, 153, 157, 159, 0,   158, 160, 0,   154, 155, 158,
      160, 153, 156, 157, 159, 292, 152, 155, 158, 160, 293, 161, 162, 163,
      165, 168, 170, 289, 291, 304, 162, 326, 163, 327, 167, 169, 0,   168,
      170, 0,   164, 165, 168, 170, 163, 166, 167, 169, 292, 162, 165, 168,
      170, 293, 0,   171, 172, 173, 175, 178, 180, 290, 291, 172, 173, 177,
      179, 0,   178, 180, 0,   174, 175, 178, 180, 173, 176, 177, 179, 294,
      172, 175, 178, 180, 295, 181, 182, 183, 185, 188, 190, 290, 291, 305,
      182, 328, 183, 329, 187, 189, 0,   188, 190, 0,   184, 185, 188, 190,
      183, 186, 187, 189, 294, 182, 185, 188, 190, 295, 0,   191, 192, 193,
      195, 198, 200, 290, 291, 192, 193, 197, 199, 0,   198, 200, 0,   194,
      195, 198, 200, 193, 196, 197, 199, 294, 192, 195, 198, 200, 295, 201,
      202, 203, 205, 208, 210, 290, 291, 306, 202, 330, 203, 331, 207, 209,
      0,   208, 210, 0,   204, 205, 208, 210, 203, 206, 207, 209, 294, 202,
      205, 208, 210, 295, 0,   211, 212, 213, 215, 218, 220, 212, 213, 217,
      219, 0,   218, 220, 0,   214, 215, 218, 220, 213, 216, 217, 219, 0,
      212, 215, 218, 220, 221, 222, 223, 225, 228, 230, 307, 222, 332, 223,
      333, 227, 229, 0,   228, 230, 0,   224, 225, 228, 230, 223, 226, 227,
      229, 0,   222, 225, 228, 230, 0,   231, 232, 233, 232, 233, 239, 242,
      0,   240, 243, 0,   237, 238, 240, 241, 243, 244, 233, 236, 239, 242,
      0,   232, 235, 237, 240, 243, 0,   232, 234, 237, 240, 241, 243, 244,
      245, 246, 247, 308, 246, 334, 247, 335, 253, 256, 0,   254, 257, 0,
      251, 252, 254, 255, 257, 258, 247, 250, 253, 256, 0,   246, 249, 251,
      254, 257, 0,   246, 248, 251, 254, 255, 257, 258, 0,   259, 260, 261,
      265, 269, 272, 260, 261, 267, 270, 0,   268, 271, 0,   265, 266, 268,
      269, 271, 272, 261, 264, 267, 270, 0,   260, 263, 265, 268, 271, 0,
      260, 262, 265, 268, 269, 271, 272, 273, 274, 275, 279, 283, 286, 309,
      274, 336, 275, 337, 281, 284, 0,   282, 285, 0,   279, 280, 282, 283,
      285, 286, 275, 278, 281, 284, 0,   274, 277, 279, 282, 285, 0,   274,
      276, 279, 282, 283, 285, 286, 0,   287, 292, 293, 0,   288, 294, 295};
    static constexpr auto nzvals = std::array{
      -1, 1,  -1, -1, -1, 1,  1,  1,  1,  -1, -1, 1,  -1, -1, -1, 1,  -1, 1,
      1,  -1, 1,  -1, 1,  1,  1,  -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1,
      1,  1,  -1, 1,  -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, -1,
      -1, 1,  1,  1,  1,  -1, -1, 1,  -1, -1, -1, 1,  -1, 1,  1,  -1, 1,  -1,
      1,  1,  1,  -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1, 1,  1,  -1, 1,
      -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, -1, -1, 1,  1,  1,
      1,  -1, 1,  1,  -1, -1, 1,  -1, 1,  1,  -1, 1,  -1, 1,  1,  1,  -1, -1,
      1,  -1, -1, 1,  -1, 1,  -1, 1,  -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, -1,
      1,  -1, 1,  -1, -1, 1,  -1, -1, 1,  1,  1,  -1, -1, 1,  -1, -1, -1, 1,
      -1, 1,  1,  -1, 1,  -1, 1,  1,  1,  -1, -1, -1, 1,  -1, 1,  -1, 1,  -1,
      1,  1,  -1, 1,  -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, -1,
      -1, 1,  1,  1,  1,  -1, 1,  1,  -1, -1, 1,  -1, 1,  1,  -1, 1,  -1, 1,
      1,  1,  -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1, -1, 1,  -1, -1, 1,
      -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, -1, -1, 1,  -1, -1, 1,  1,
      1,  1,  -1, 1,  1,  -1, 1,  1,  -1, 1,  -1, -1, 1,  -1, 1,  1,  -1, 1,
      -1, 1,  1,  1,  -1, -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1,
      -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1,
      -1, 1,  -1, -1, -1, 1,  -1, 1,  -1, 1,  1,  1,  -1, -1, 1,  -1, -1, 1,
      -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1, -1, -1, 1,
      -1, -1, 1,  -1, 1,  -1, 1,  -1, 1,  -1, 1,  1,  -1, 1,  1,  -1, 1,  -1,
      -1, 1,  -1, 1,  1,  -1, 1,  -1, 1,  1,  -1, 1,  -1, -1, -1, 1,  -1, 1,
      1,  1,  -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  1,  -1, 1,
      -1, 1,  1,  -1, -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1, 1,  1,  -1,
      1,  1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1, -1,
      -1, 1,  -1, -1, 1,  1,  1,  1,  -1, 1,  1,  -1, 1,  1,  -1, 1,  -1, -1,
      1,  -1, 1,  1,  -1, 1,  -1, 1,  1,  1,  -1, -1, -1, 1,  -1, 1,  -1, -1,
      1,  -1, 1,  -1, 1,  -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,
      -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, -1, -1, 1,  -1, 1,  -1, 1,  1,  1,
      -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,
      -1, 1,  -1, -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1, 1,  -1, 1,  1,
      -1, 1,  1,  -1, 1,  -1, -1, 1,  -1, 1,  1,  -1, 1,  -1, 1,  1,  -1, 1,
      -1, -1, -1, 1,  -1, 1,  -1, 1,  1,  1,  -1, -1, 1,  -1, -1, 1,  -1, 1,
      -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1, -1, -1, 1,  -1, -1,
      1,  -1, 1,  -1, 1,  -1, 1,  -1, 1,  1,  -1, 1,  1,  -1, 1,  -1, -1, 1,
      -1, 1,  1,  -1, 1,  -1, 1,  1,  -1, 1,  -1, -1, -1, 1,  -1, 1,  1,  1,
      -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  1,  -1, 1,  -1, 1,
      1,  -1, -1, -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -1, 1,  1,  -1, 1,  1,
      -1, 1,  -1, -1, 1,  -1, 1,  -1, -1, 1,  -1, 1,  -1, 1,  -2, -1, 1,  1,
      1,  -1, 1,  1,  -1, 1,  1,  1,  1,  2,  -1, -2, -1, 1,  -1, 1,  -1, -1,
      1,  1,  -1, 1,  -1, -1, 1,  -1, -1, -2, 1,  2,  1,  -2, -1, -1, 1,  -1,
      1,  -1, 1,  -1, -1, 1,  -1, -1, 1,  1,  1,  2,  -1, -2, -1, 1,  -1, 1,
      1,  -1, 1,  1,  -1, 1,  1,  -1, 1,  -1, -1, -2, 1,  2,  -1, 1,  -2, -1,
      -2, -2, 2,  1,  1,  1,  -1, -1, 1,  -1, -1, 1,  1,  1,  2,  -1, -2, -1,
      1,  -1, 1,  1,  -1, 1,  1,  -1, 1,  1,  -1, 1,  -1, -1, -2, 1,  2,  1,
      -2, -1, -2, -2, 2,  -1, 1,  -1, 1,  -1, 1,  -1, 1,  1,  -1, 1,  1,  1,
      1,  2,  -1, -2, -1, 1,  -1, 1,  -1, -1, 1,  1,  -1, 1,  -1, -1, 1,  -1,
      -1, -2, 1,  2,  1,  -1, 1,  1,  1,  -1, 1,  1};
    for (int i = 0; i < 840; ++i) C[nzrows[i], nzcols[i]] = nzvals[i];
    alloc::Arena<> alloc = managed_alloc;
    Simplex &simp{simplexFromTableau(&alloc, C)};
    expect(simp.initiateFeasible());
  };
  return 0;
}
